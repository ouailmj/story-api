{% extends "client/event/base_event.html.twig" %}
{% block title %}AppBundle:Default:index{% endblock %}

{% block container %}
<div class="main">
        <div class="progressbar-container">
            <ul class="progress-indicator">
            <li class="completed">
                <span class="bubble"></span>
                Choose plan
            </li>
            <li class="active">
                <span class="bubble"></span>
                Add Challenge
            </li>
            <li>
                <span class="bubble"></span>
                Event information
            </li>
            <li>
                <span class="bubble"></span>
                Event Cover
            </li>
            <li>
                <span class="bubble"></span>
                Payment
            </li>
            <li>
                <span class="bubble"></span>
                Invite Friends
            </li>
        </ul>
        </div>
    {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}
     {% form_theme form 'Form/Registration/fields.html.twig' %}
        <div class="event-challenge-form animated zoomInUp">
                <div class="challange-event">
                    {{ form_widget(form.challenges)}}
                </div>
            {{ form_rest(form)}}
            <div class="arrows">
                <ul>

                    <a href="{{ path('add_event_event_information' , { 'id' : event.id}) }}"><li class="margin-right previous"><i class="icon-arrow-left12"></i></li></a>
                    <button type="submit"><li class="next"><i class="icon-arrow-right13"></i></li></button>
                </ul>
        </div>
        </div>
       {{ form_end(form) }}
</div>

        <script src="{{ asset('assets/js/plugins/symfony_collectionjs/jquery.collection.js') }}"></script>
        <script type="text/javascript">
            $('.my-challenge').collection({
                    name_prefix: "{{ form.challenges.vars.full_name }}",
                    add_at_the_end: true,
                    hide_useless_buttons: true,
                    add: '<a href="#" class="collection-action btn btn-info btn-small collection-rescue-add">Ajouter une challenge</a>',
                    remove: '<a href="#" class="collection-remove btn btn-warning collection-action">Retirer</a>',
                    allow_up: false,
                    allow_down: false,
                    init_with_n_elements: 0,
                }
            );

        </script>
        <script>
            function getElementsFinishWithId( id ) {
                var children = document.body.getElementsByTagName('*');
                var elements = [], child;
                for (var i = 0; i < children.length; i++) {

                    child = children[i];
                    if (child.id.split('_')[4] == id)
                        elements.push(child);
                }
                return elements;
            }
           elements =  getElementsFinishWithId('randomDate') ;

            elements.forEach((element)=>{
                onChangeCheckbox(element)
            });

            function onChangeCheckbox(element){

               let id = element.id.split('_')[3];
                let state = false;
                if( element.checked){
                    state = true;
                };

                var nodes = document.getElementById('appbundle_event_challenges_'+id+'_plannedAtHour').getElementsByTagName('*');
                for(var i = 0; i < nodes.length; i++){
                    nodes[i].disabled = state;
                }
            }
        </script>
    <script>
        {% for challenge in event.challenges  %}
            {% set hour = challenge.plannedAt|date('H') %}
            {% set minute = challenge.plannedAt|date('m') %}
            {% set idHour = 'appbundle_event_challenges_'~ (loop.index-1) ~'_plannedAtHour_hour' %}
            {% set idMinute = 'appbundle_event_challenges_'~ (loop.index-1) ~'_plannedAtHour_minute' %}
        document.getElementById('{{ idHour }}').getElementsByTagName('option')[{{ hour }}].selected = 'selected';
        document.getElementById('{{ idMinute }}').getElementsByTagName('option')[{{ minute }}].selected = 'selected';
        {% endfor %}
    </script>

{% endblock %}
